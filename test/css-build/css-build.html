<!doctype html>
<!--
@license
Copyright (c) 2018 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<html>
<head>
  <meta charset="utf-8">
  <script src="../../node_modules/@webcomponents/webcomponentsjs/webcomponents-bundle.js"></script>
  <script src="../unit/wct-browser-config.js"></script>
  <script src="../../node_modules/wct-browser-legacy/browser.js"></script>
  <script type="module" src="../../polymer-legacy.js"></script>
</head>
<body>
  <custom-style>
    <style is="custom-style">
      html {
        --mixin: {
          background-color: rgb(123, 123, 123);
        };
        --border: 10px dotted orange;
      }
    </style>
  </custom-style>

  <dom-module id="css-build">
    <template>
      <style>
        :host {
          @apply --mixin;
          display: block;
        }
        :host(.ignore-background) {
          background-color: rgb(255, 0, 0);
        }
        #div {
          border: var(--border, 2px solid black);
        }
        #container ::slotted(*) {
          padding-left: 10px;
        }
      </style>
      <div id="div"></div>
      <div id="container">
        <slot></slot>
      </div>
    </template>
  </dom-module>

  <div id="arena"></div>

  <script type="module">
    import './css-build.js';

    const arena = document.querySelector('#arena');

    function assertComputed(node, expectedValue, property = 'border-top-width') {
      const propertyValue = window.getComputedStyle(node).getPropertyValue(property).trim();
      assert.equal(propertyValue, expectedValue, `css property ${property}`);
    }

    suite('CSS Build tests', function() {
      let el;
      setup(function() {
        el = document.createElement('css-build');
        arena.appendChild(el);
      });

      teardown(function() {
        arena.innerHTML = '';
      });

      test('mixins applied', function() {
        assertComputed(el, 'rgb(123, 123, 123)', 'background-color');
      });

      test('CSS Custom Properties applied', function() {
        const div = el.shadowRoot.querySelector('#div');
        assertComputed(div, '10px');
      });

      test(':host() applied', function() {
        el.classList.add('ignore-background');
        if (!window.ShadyCSS.nativeCss) {
          window.ShadyCSS.styleDocument();
        }
        assertComputed(el, 'rgb(255, 0, 0)', 'background-color');
      });

      test('::slotted applied', function() {
        const span = document.createElement('span');
        el.appendChild(span);
        if (window.ShadyDOM && window.ShadyDOM.inUse) {
          window.ShadyDOM.flush();
        }
        assertComputed(span, '10px', 'padding-left');
      });
    });
  </script>
</body>
</html>